# ISPManager with Ammina plugins
__Проект находится в разработке. Выпуск в релиз при присвоении тега версии__ 

ISPManager с автоматической установкой и настройкой и плагинами Ammina

## Поддерживаемые операционные системы
* Debian 12 - рекомендуется
* Ubuntu 22.04

## Поддерживаемые специфичные настройки для CMS и фреймворков
* Laravel
* 1С-Битрикс управление сайтом
* 1С-Битрикс корпоративный портал

## Возможности
1. Автоматическая установка и настройка ISPManager
2. Автоматическое обновление
3. Плагины для ПО:
   * Redis
   * Memcached
   * Bitrix Push Server
4. Установка Composer для сайтов на laravel и bitrix
5. Короткие команды php с подключением версии PHP и конфигурации сайта
6. Переключение между сайтами (PATH переменная и команды) в командной строке
7. Для laravel:
   * Работа в режиме Apache FastCGI или Nginx PHP-FPM
   * Автозавершение команд artisan (artisan_cache команда для создания/обновления кеша)
   * Короткая команда artisan вместо php artisan
8. Для 1С-Битрикс:
   * Работа в режиме Apache FastCGI или Nginx PHP-FPM
   * Автоматическое заведение и подключение базы данных при создании хоста сайта
   * Поддержка старых версий главного модуля (до 20.100) - не рекомендую. Лучше обновить битрикс.
   * Поддержка композитного режима на уровне nginx (с кешированием в файлах или memcached)
   * Возможность создать дополнительный сайт для многосайтовости (будут созданы символические ссылки на папки /bitrix /local /upload)
   * Автоматическая настройка агентов на крон
   * Настройка кеша сайта на memcached или redis (не рекомендую, т.к. диски nvme и ssd хорошо справляются, а стоят дешевле необходимых объемов памяти)
   * Настройка логирования битрикс
   * Настройки для модуля [Ammina Optimizer: Оптимизация и ускорение загрузки сайта (CSS, JS, HTML, изображения, WebP, Lazy)](https://marketplace.1c-bitrix.ru/solutions/ammina.optimizer/)
   * Настройки для модуля [Ammina. Регионы (филиалы и представительства). Мультирегиональность на доменах и URL адресах ](https://marketplace.1c-bitrix.ru/solutions/ammina.regions/)
   * Настройки для модуля [Ammina Backup: Резервное копирование (бэкап на Яндекс диск, FTP, Dropbox, Mail.ru, SFTP)](https://marketplace.1c-bitrix.ru/solutions/ammina.backup/)
9. Настройки для SEO:
   * Блокировка поисковых роботов (например для сайта разработки)
   * Редирект на https
   * Редирект на домен с/без www
   * Редирект на страницу с/без символом слеш (/)
   * Редирект на страницу без index.php
   * Удаление множественных слешей

## Установка

### Для всех поддерживаемых операционных систем:
1. Клонируйте решение к себе на сервер, выполнив под пользователем root команды:
```shell

apt install -y git-core
git clone https://github.com/AmminaSolutions/ispmanager.ammina.plugins.git /opt/ispmanager.ammina.plugins
cd /opt/ispmanager.ammina.plugins
sh step1.sh
```
В процессе установки будет задан вопрос об имени сервера. Необходимо указать полное имя сервера. Например:
```
srv01.ammina-isp.ru
```

2. После выполнения данного шага необходимо авторизоваться в панели управления через браузер, активировать лицензию и перезагрузить сервер командой
```shell
reboot
```

3. После перезагрузки выполните шаг 2 настройки:
```shell

cd /opt/ispmanager.ammina.plugins
sh step2.sh
```
В процессе настройки могут быть заданы несколько вопросов по настройкам. Варианты ответов по-умолчанию являются оптимальными для большинства пользователей.

4. После выполнения шага 2 необходимо авторизоваться в панели управления и создать первого пользователя.
> ОБРАТИТЕ ВНИМАНИЕ! Для пользователей необходимо разрешать доступ к shell, т.к. выполняются команды для настройки сайтов данного пользователя.
> Так же не используйте native версии PHP для сайтов.

5. Если планируется использовать redis или memcached - необходимо настроить их в панели управления.

6. Если планируется использовать bitrix push server - необходимо настроить его после создания сайта в панели управления.

7. После этого можно переходить к созданию и настройке сайтов через панель управления.


### Особенности установки на Ubuntu 22.04
Дополнительно будет задан вопрос об устанавливаемом сервере базы данных. По умолчанию будет установлен сервер MySQL. При отрицательном ответе на вопрос - MariaDB.

___Данная возможность доступно только для операционных систем Ubuntu___


## Команды

### Синхронизация файлов настроек
Выполняется синхронизация файлов настроек с каталогами операционной системы.

```shell
sh /opt/ispmanager.ammina.plugins/commands/sync.files.sh
```

Порядок каталогов для проверки исходных файлов:
* /core/files/**
* /$OSDIR/files/**
* /.local/files/**

Только измененные файлы заменяются. Если в каталоги операционной системы записывается.

#### Автоматическое выполнение команд при обновлении файлов в операционной системе
Для автоматического выполнения команд при изменении файлов (например обновился аддон ISPManager), необходимо в каталоге разместить файл .service.command, который содержит shell команды для выполнения. Команды должны разделяться двойным переносом строк.

> Действие данного файла распространяется на каталог расположения и все подкаталоги

Пример:
```shell
pkill core

service nginx restart
```

# Рекомендуемые хостинги

| Хостинг | Описание                                                                                | Примечание                                                                                                                                                                     | Бюджет в месяц | Ссылка для перехода                                 |
|---|-----------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|-----------------------------------------------------|
| Selectel | Выделенные серверы. Есть аукцион серверов, где можно подобрать сервер по приятной цене. | Из недорогой серии стоит брать сервера с desktop процессорами (intel core, amd). Обязательно с ssd или nvme дисками. Частоту процессора - не менее 3,5ГГц                      | от 5000 руб    | [Перейти](https://selectel.ru/?ref_code=df4c5fcc02) |
| Евробайт | VDS в России и Амстердаме                                                               | Низкая частота процессора, но достаточно большой диск - 160/240Гб nvme. Всегда стоит брать только тариф К-8192                                                                 | 1135-2270 руб  | [Перейти](https://eurobyte.ru/?referer=180008)      |
| FirstVDS | VDS различных конфигураций. Есть конфигурации с быстрыми процессорами до 5.7 Ггц.       | Рекомендуется брать не менее 2 ядер процессора                                                                                                                                 | от 1000 руб    | [Перейти](https://firstvds.ru/?from=1038221)        |
| 1Dedic | Выделенные серверы                                                                      | Для большинства проектов подойдет сконфигурированный сервер на процессорах IntelCore и AMD Ryzen. Позволяет настроить сервер под требования и по необходимости модернизировать | от 10000 руб   | [Перейти](https://firstdedic.ru/?from=1038221)      |

